#!/bin/bash
set -e  # Dừng ngay nếu có lỗi

# 1. Cài đặt Python và venv (nếu chưa có)
if ! command -v python3 &> /dev/null
then
    echo "Python3 chưa được cài, tiến hành cài đặt..."
    apt-get update && apt-get install -y python3 python3-venv python3-pip
fi

# 2. Tạo môi trường ảo (nếu chưa có)
if [ ! -d "venv" ]; then
    echo "Đang tạo môi trường ảo..."
    python3 -m venv venv
fi

# 3. Kích hoạt môi trường ảo
echo "Kích hoạt môi trường ảo..."
source venv/bin/activate

# 4. Cài thư viện từ requirements.txt
if [ -f "requirements.txt" ]; then
    echo "Cài đặt thư viện từ requirements.txt..."
    pip install --upgrade pip
    pip install -r requirements.txt
else
    echo "⚠️ Không tìm thấy requirements.txt!"
fi

# 5. Chạy script Python
echo "Chạy script data_downloader.py..."
python data_downloader.py
